{
  "resourceType": "Questionnaire",
  "id": "AgedCareQIPrototype",
  "meta": {
    "profile": [
      "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-render",
      "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-pop-exp"
    ]
  },
  "url": "https://smartforms.csiro.au/ig/Questionnaire/AgedCareQIPrototype",
  "contained": [
    {
      "resourceType": "ValueSet",
      "id": "PressureInjuryClassification",
      "status": "active",
      "name": "PressureInjuryClassification",
      "title": "Pressure Injury Classification",
      "description": "Pressure Injury Classification.",
      "version": "0.1.0",
      "url": "https://smartforms.csiro.au/ig/ValueSet/PressureInjuryClassification",
      "expansion": {
        "timestamp": "2023-06-20T09:43:07+10:00",
        "contains": [
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "code": "L89.0",
            "display": "Pressure injury, stage I"
          },
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "code": "L89.1",
            "display": "Pressure injury, stage II"
          },
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "code": "L89.2",
            "display": "Pressure injury, stage III"
          },
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "code": "L89.3",
            "display": "Pressure injury, stage IV"
          },
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "code": "L89.4",
            "display": "Pressure injury, unstageable, so stated"
          },
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "code": "L89.5",
            "display": "Suspected deep tissue injury, depth unknown, so stated"
          }
        ]
      },
      "compose": {
        "include": [
          {
            "system": "http://hl7.org/fhir/sid/icd-10-am",
            "concept": [
              {
                "code": "L89.0",
                "display": "Pressure injury, stage I"
              },
              {
                "code": "L89.1",
                "display": "Pressure injury, stage II"
              },
              {
                "code": "L89.2",
                "display": "Pressure injury, stage III"
              },
              {
                "code": "L89.3",
                "display": "Pressure injury, stage IV"
              },
              {
                "code": "L89.4",
                "display": "Pressure injury, unstageable, so stated"
              },
              {
                "code": "L89.5",
                "display": "Suspected deep tissue injury, depth unknown, so stated"
              }
            ]
          }
        ]
      }
    }
  ],
  "extension": [
    {
      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-launchContext",
      "extension": [
        {
          "url": "name",
          "valueCoding": {
            "code": "patient",
            "system": "http://hl7.org/fhir/uv/sdc/CodeSystem/launchContext"
          }
        },
        {
          "url": "type",
          "valueCode": "Patient"
        },
        {
          "url": "description",
          "valueString": "The patient that is to be used to pre-populate the form"
        }
      ]
    },
    {
      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-launchContext",
      "extension": [
        {
          "url": "name",
          "valueCoding": {
            "code": "user",
            "system": "http://hl7.org/fhir/uv/sdc/CodeSystem/launchContext"
          }
        },
        {
          "url": "type",
          "valueCode": "Practitioner"
        },
        {
          "url": "description",
          "valueString": "The practitioner user that is to be used to pre-populate the form"
        }
      ]
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/variable",
      "valueExpression": {
        "name": "Condition",
        "language": "application/x-fhir-query",
        "expression": "Condition?patient={{%patient.id}}"
      }
    }
  ],
  "name": "AgedCareQIPrototype",
  "title": "Aged Care QI Prototype",
  "status": "draft",
  "experimental": true,
  "subjectType": [
    "Patient"
  ],
  "date": "2023-07-07",
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "AU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "item": [
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "code": "tab-container",
                "system": "http://hl7.org/fhir/questionnaire-item-control"
              }
            ]
          }
        }
      ],
      "linkId": "tab-container",
      "type": "group",
      "repeats": false,
      "item": [
        {
          "linkId": "client",
          "text": "Client Details",
          "type": "group",
          "required": true,
          "repeats": false,
          "item": [
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                  "valueExpression": {
                    "language": "text/fhirpath",
                    "expression": "(%patient.name.where(use='official').select((family | (given | prefix).join(' ')).join(', ') | text) | %patient.name.where(use!='official').select((family | (given | prefix).join(' ')).join(', ') | text)).first()"
                  }
                }
              ],
              "linkId": "client-name",
              "text": "Name",
              "type": "string",
              "required": true,
              "repeats": false,
              "readOnly": true
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                  "valueExpression": {
                    "language": "text/fhirpath",
                    "expression": "%patient.birthDate"
                  }
                }
              ],
              "linkId": "client-dob",
              "text": "Date of birth",
              "type": "date",
              "required": true,
              "repeats": false,
              "readOnly": true
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                  "valueExpression": {
                    "language": "text/fhirpath",
                    "expression": "iif(today().toString().select(substring(5,2) & substring(8,2)).toInteger() > %patient.birthDate.toString().select(substring(5,2) & substring(8,2)).toInteger(), today().toString().substring(0,4).toInteger() - %patient.birthDate.toString().substring(0,4).toInteger(), today().toString().substring(0,4).toInteger() - %patient.birthDate.toString().substring(0,4).toInteger() - 1)"
                  }
                }
              ],
              "linkId": "client-age",
              "text": "Age",
              "type": "integer",
              "required": true,
              "repeats": false,
              "readOnly": true
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                  "valueExpression": {
                    "language": "text/fhirpath",
                    "expression": "%patient.gender"
                  }
                }
              ],
              "linkId": "client-gender",
              "text": "Administrative Gender",
              "type": "choice",
              "required": false,
              "repeats": false,
              "readOnly": true,
              "answerValueSet": "http://hl7.org/fhir/ValueSet/administrative-gender"
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                  "valueExpression": {
                    "language": "text/fhirpath",
                    "expression": "%patient.gender"
                  }
                }
              ],
              "linkId": "client-eol",
              "text": "Receiving end-of-life care",
              "type": "boolean",
              "repeats": false
            }
          ]
        },
        {
          "extension": [
            {
              "url": "http://hl7.org/fhir/StructureDefinition/variable",
              "valueExpression": {
                "name": "PressureInjuries",
                "language": "text/fhirpath",
                "expression": "item.where(linkId='qi-pi-4').item.where(linkId='qi-pi-4-1').answer.value"
              }
            }
          ],
          "linkId": "qi-pi",
          "text": "Pressure Injuries",
          "type": "group",
          "repeats": false,
          "required": true,
          "item": [
            {
              "linkId": "qi-pi-2",
              "text": "Date of last assessment",
              "type": "date",
              "repeats": false,
              "required": true
            },
            {
              "linkId": "qi-pi-3",
              "text": "Withheld consent for pressure injury assessment for the entire quarter",
              "type": "boolean",
              "repeats": false,
              "required": true
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                  "valueCodeableConcept": {
                    "coding": [
                      {
                        "code": "gtable",
                        "system": "http://hl7.org/fhir/questionnaire-item-control"
                      }
                    ]
                  }
                },
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-itemPopulationContext",
                  "valueExpression": {
                    "name": "ConditionRepeatPIs",
                    "language": "text/fhirpath",
                    "expression": "%Condition.entry.resource.where(clinicalStatus.coding.code='active' and code.coding.where(system='http://hl7.org/fhir/sid/icd-10-am' and (code='L89.0' or code='L89.1' or code='L89.2' or code='L89.3' or code='L89.4' or code='L89.5')))"
                  }
                }
              ],
              "linkId": "qi-pi-4",
              "text": "Pressure Injuries Classification List (active)",
              "type": "group",
              "repeats": true,
              "item": [
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "drop-down",
                            "system": "http://hl7.org/fhir/questionnaire-item-control"
                          }
                        ]
                      }
                    },
                    {
                      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                      "valueExpression": {
                        "language": "text/fhirpath",
                        "expression": "%ConditionRepeatPIs.code.coding.where(system='http://hl7.org/fhir/sid/icd-10-am' and (code='L89.0' or code='L89.1' or code='L89.2' or code='L89.3' or code='L89.4' or code='L89.5'))"
                      }
                    }
                  ],
                  "linkId": "qi-pi-4-1",
                  "text": "Pressure Injury",
                  "type": "choice",
                  "answerValueSet": "#PressureInjuryClassification"
                },
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
                      "valueExpression": {
                        "language": "text/fhirpath",
                        "expression": "%ConditionRepeatPIs.onset.ofType(dateTime)"
                      }
                    }
                  ],
                  "linkId": "qi-pi-4-2",
                  "text": "Onset Date",
                  "type": "dateTime"
                },
                {
                  "linkId": "qi-pi-4-3",
                  "text": "Acquired outside of service during quarter?",
                  "type": "boolean"
                }
              ]
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
                  "valueExpression": {
                    "description": "Pressure injury count",
                    "language": "text/fhirpath",
                    "expression": "%PressureInjuries.count()"
                  }
                }
              ],
              "linkId": "qi-pi-5",
              "text": "Number of pressure injuries",
              "type": "integer",
              "repeats": false,
              "required": true
            }
          ]
        },
        {
          "linkId": "qi-restraint",
          "text": "Physical Restraint",
          "type": "group",
          "repeats": false,
          "required": true,
          "item": [
            {
              "linkId": "qi-restraint-1",
              "text": "Date of assessment",
              "type": "date",
              "repeats": false,
              "required": true
            },
            {
              "linkId": "qi-restraint-2",
              "text": "Absent during assessment period",
              "type": "boolean",
              "repeats": false,
              "required": true
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                  "valueCodeableConcept": {
                    "coding": [
                      {
                        "code": "gtable",
                        "system": "http://hl7.org/fhir/questionnaire-item-control"
                      }
                    ]
                  }
                }
              ],
              "linkId": "qi-restraint-3",
              "text": "Physical restraints present during assessment period",
              "type": "group",
              "repeats": true,
              "item": [
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "drop-down",
                            "system": "http://hl7.org/fhir/questionnaire-item-control"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-restraint-3-1",
                  "text": "Physical restraint type",
                  "type": "choice",
                  "answerOption": [
                    {
                      "valueCoding": {
                        "code": "iN6a",
                        "system": "https://interrai.org/",
                        "display": "a. Full bed rails on all open sides of bed"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "iN6b",
                        "system": "https://interrai.org/",
                        "display": "b. Trunk restraint"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "iN6c",
                        "system": "https://interrai.org/",
                        "display": "c. Chair prevents rising"
                      }
                    }
                  ]
                },
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "drop-down",
                            "system": "http://hl7.org/fhir/questionnaire-item-control"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-restraint-3-2",
                  "text": "Frequency of use",
                  "type": "choice",
                  "answerOption": [
                    {
                      "valueCoding": {
                        "code": "0",
                        "system": "https://interrai.org/",
                        "display": "0. Not used"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "1",
                        "system": "https://interrai.org/",
                        "display": "1. Used less than daily"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "2",
                        "system": "https://interrai.org/",
                        "display": "2. Used daily-Nights only"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "3",
                        "system": "https://interrai.org/",
                        "display": "3. Used daily-Days only"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "4",
                        "system": "https://interrai.org/",
                        "display": "4. Used nights and days, but not constant"
                      }
                    },
                    {
                      "valueCoding": {
                        "code": "5",
                        "system": "https://interrai.org/",
                        "display": "5. Constant use for full 24 hours (may include periodic releases)"
                      }
                    }
                  ]
                }
              ]
            },
            {
              "linkId": "qi-restraint-4",
              "text": "Restrained through use of secure area during assessment period",
              "type": "boolean",
              "repeats": false,
              "required": true
            }
          ]
        },
        {
          "extension": [
            {
              "url": "http://hl7.org/fhir/StructureDefinition/variable",
              "valueExpression": {
                "name": "PreviousWeight",
                "language": "text/fhirpath",
                "expression": "item.where(linkId='qi-weight-3').item.where(linkId='qi-weight-3-1').answer.value"
              }
            },
            {
              "url": "http://hl7.org/fhir/StructureDefinition/variable",
              "valueExpression": {
                "name": "FinishingWeight",
                "language": "text/fhirpath",
                "expression": "item.where(linkId='qi-weight-3').item.where(linkId='qi-weight-3-4').answer.value"
              }
            }
          ],
          "linkId": "qi-weight",
          "text": "Unplanned Weight Loss",
          "type": "group",
          "repeats": false,
          "required": true,
          "item": [
            {
              "linkId": "qi-weight-1",
              "text": "Undertaking weight loss strategy",
              "type": "boolean",
              "repeats": false,
              "required": true
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                  "valueCodeableConcept": {
                    "coding": [
                      {
                        "code": "check-box",
                        "system": "http://hl7.org/fhir/questionnaire-item-control"
                      }
                    ]
                  }
                },
                {
                  "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-choiceOrientation",
                  "valueCode": "vertical\""
                }
              ],
              "linkId": "qi-weight-2",
              "text": "Withheld consent to be weighed",
              "type": "choice",
              "repeats": true,
              "answerOption": [
                {
                  "valueString": "On the starting weight collection date"
                },
                {
                  "valueString": "On the middle weight collection date"
                },
                {
                  "valueString": "On the finishing weight collection date"
                }
              ]
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                  "valueCodeableConcept": {
                    "coding": [
                      {
                        "code": "gtable",
                        "system": "http://hl7.org/fhir/questionnaire-item-control"
                      }
                    ]
                  }
                }
              ],
              "linkId": "qi-weight-3",
              "text": "Recorded weights",
              "type": "group",
              "repeats": true,
              "item": [
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-unit",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "kg",
                            "system": "http://unitsofmeasure.org",
                            "display": "kg"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-weight-3-1",
                  "text": "Previous weight",
                  "type": "decimal",
                  "item": [
                    {
                      "extension": [
                        {
                          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                          "valueCodeableConcept": {
                            "coding": [
                              {
                                "code": "unit",
                                "system": "http://hl7.org/fhir/questionnaire-item-control"
                              }
                            ]
                          }
                        }
                      ],
                      "linkId": "qi-weight-3-1-1",
                      "text": "kg",
                      "type": "display"
                    }
                  ]
                },
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-unit",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "kg",
                            "system": "http://unitsofmeasure.org",
                            "display": "kg"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-weight-3-2",
                  "text": "Starting weight",
                  "type": "decimal",
                  "item": [
                    {
                      "extension": [
                        {
                          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                          "valueCodeableConcept": {
                            "coding": [
                              {
                                "code": "unit",
                                "system": "http://hl7.org/fhir/questionnaire-item-control"
                              }
                            ]
                          }
                        }
                      ],
                      "linkId": "qi-weight-3-2-1",
                      "text": "kg",
                      "type": "display"
                    }
                  ]
                },
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-unit",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "kg",
                            "system": "http://unitsofmeasure.org",
                            "display": "kg"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-weight-3-3",
                  "text": "Middle weight",
                  "type": "decimal",
                  "item": [
                    {
                      "extension": [
                        {
                          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                          "valueCodeableConcept": {
                            "coding": [
                              {
                                "code": "unit",
                                "system": "http://hl7.org/fhir/questionnaire-item-control"
                              }
                            ]
                          }
                        }
                      ],
                      "linkId": "qi-weight-3-3-1",
                      "text": "kg",
                      "type": "display"
                    }
                  ]
                },
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-unit",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "kg",
                            "system": "http://unitsofmeasure.org",
                            "display": "kg"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-weight-3-4",
                  "text": "Finishing weight",
                  "type": "decimal",
                  "item": [
                    {
                      "extension": [
                        {
                          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                          "valueCodeableConcept": {
                            "coding": [
                              {
                                "code": "unit",
                                "system": "http://hl7.org/fhir/questionnaire-item-control"
                              }
                            ]
                          }
                        }
                      ],
                      "linkId": "qi-weight-3-4-1",
                      "text": "kg",
                      "type": "display"
                    }
                  ]
                }
              ]
            },
            {
              "extension": [
                {
                  "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
                  "valueExpression": {
                    "description": "Percentage weight change",
                    "language": "text/fhirpath",
                    "expression": "((%FinishingWeight-%PreviousWeight)/%PreviousWeight)*100"
                  }
                },
                {
                  "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-unit",
                  "valueCodeableConcept": {
                    "coding": [
                      {
                        "code": "%",
                        "system": "http://unitsofmeasure.org"
                      }
                    ]
                  }
                }
              ],
              "linkId": "qi-weight-4",
              "text": "Weight change over quarter",
              "type": "decimal",
              "repeats": false,
              "item": [
                {
                  "extension": [
                    {
                      "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
                      "valueCodeableConcept": {
                        "coding": [
                          {
                            "code": "unit",
                            "system": "http://hl7.org/fhir/questionnaire-item-control"
                          }
                        ]
                      }
                    }
                  ],
                  "linkId": "qi-weight-4-1",
                  "text": "%",
                  "type": "display"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
